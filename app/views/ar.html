<html>

<head>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script
  src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

<script>
  //create intro button and append it to dom
  let createIntroButton = () => {
    //only create button once
    var element = document.getElementById('intro-button');
    if (element == null) {
      var introButton = document.createElement("BUTTON");
      var buttonTextEl = document.createElement("span");
      buttonTextEl.className = "picon-p-add-news";
      buttonTextEl.innerText = "Introduction";
      introButton.appendChild(buttonTextEl);
      introButton.className = "intro-button";
      introButton.id = "intro-button";
      var divForButton = document.getElementById("buttonDiv");
      divForButton.appendChild(introButton);
    }
  }

  //create componentScene button and append it to dom
  let createComponentSceneButton = () => {
    //only create button once
    var element = document.getElementById('componentScene-button');
    if (element == null) {
      var button = document.createElement("BUTTON");
      var buttonTextEl = document.createElement("span");
      buttonTextEl.className = "picon-p-add-news";
      buttonTextEl.innerText = "Overview";
      button.appendChild(buttonTextEl);
      button.className = "componentScene-button";
      button.id = "componentScene-button";
      var divForButton = document.getElementById("buttonDiv");
      divForButton.appendChild(button);
    }

  }
  //create componentScene button and append it to dom
  let createComponent1Button = () => {
    //only create button once
    var element = document.getElementById('component1-button');
    if (element == null) {
      var button = document.createElement("BUTTON");
      var buttonTextEl = document.createElement("span");
      buttonTextEl.className = "picon-p-add-news";
      buttonTextEl.innerText = "1";
      button.appendChild(buttonTextEl);
      button.className = "component1-button";
      button.id = "component1-button";
      var divForButton = document.getElementById("componentsButtonDiv");
      divForButton.appendChild(button);
    }

  }

  //create componentScene button and append it to dom
  let createComponent2Button = () => {
    //only create button once
    var element = document.getElementById('component2-button');
    if (element == null) {
      var button = document.createElement("BUTTON");
      var buttonTextEl = document.createElement("span");
      buttonTextEl.className = "picon-p-add-news";
      buttonTextEl.innerText = "2";
      button.appendChild(buttonTextEl);
      button.className = "component2-button";
      button.id = "component2-button";
      var divForButton = document.getElementById("componentsButtonDiv");
      divForButton.appendChild(button);
    }

  }
  //create componentScene button and append it to dom
  let createComponent3Button = () => {
    //only create button once
    var element = document.getElementById('component3-button');
    if (element == null) {
      var button = document.createElement("BUTTON");
      var buttonTextEl = document.createElement("span");
      buttonTextEl.className = "picon-p-add-news";
      buttonTextEl.innerText = "3";
      button.appendChild(buttonTextEl);
      button.className = "component3-button";
      button.id = "component3-button";
      var divForButton = document.getElementById("componentsButtonDiv");
      divForButton.appendChild(button);
    }

  }

  //play intro vid when clicked on button
  let playIntroVid = async () => {
    document.querySelector(".intro-button").addEventListener("click", function () {
      //change vid src
      this.vid = document.getElementById("videoSrc");
      if (this.vid.src != "https://192.168.1.172:3000/introVideo.mp4") {
        this.vid.src = "https://192.168.1.172:3000/introVideo.mp4";
        this.vid.play();
      }
      else {
        if (this.vid.paused) {
          this.vid.play()
        }
        else {
          this.vid.pause();

        }
      }
    });
  }

  //play component vid when clicked on button
  let playComponentVid = async () => {
    document.querySelector(".componentScene-button").addEventListener("click", function () {
      //change vid src
      this.vid = document.getElementById("videoSrc");
      if (this.vid.src != "https://192.168.1.172:3000/ComponentScene.mp4") {
        this.vid.src = "https://192.168.1.172:3000/ComponentScene.mp4";
        this.vid.play();

        //show buttons for the 3 components
        let c1 = document.getElementById("component1-button");
        c1.style.visibility = "visible";
        let c2 = document.getElementById("component2-button");
        c2.style.visibility = "visible";
        let c3 = document.getElementById("component3-button");
        c3.style.visibility = "visible";
      }
      else {
        if (this.vid.paused) {
          this.vid.play()
  
        }
        else {
          this.vid.pause();

        }
      }
    });
  }

   //play component vid when clicked on button
   let playComponent1Vid = async () => {
    document.querySelector(".component1-button").addEventListener("click", function () {
      //change vid src
      this.vid = document.getElementById("videoSrc");
      if (this.vid.src != "https://192.168.1.172:3000/Component1.mp4") {
        this.vid.src = "https://192.168.1.172:3000/Component1.mp4";
        this.vid.play();
      }
      else {
        if (this.vid.paused) {
          this.vid.play()
        }
        else {
          this.vid.pause();

        }
      }
    });
  }
   //play component vid when clicked on button
   let playComponent2Vid = async () => {
    document.querySelector(".component2-button").addEventListener("click", function () {
      //change vid src
      this.vid = document.getElementById("videoSrc");
      if (this.vid.src != "https://192.168.1.172:3000/Component2.mp4") {
        this.vid.src = "https://192.168.1.172:3000/Component2.mp4";
        this.vid.play();
      }
      else {
        if (this.vid.paused) {
          this.vid.play()
        }
        else {
          this.vid.pause();

        }
      }
    });
  }
   //play component vid when clicked on button
   let playComponent3Vid = async () => {
    document.querySelector(".component3-button").addEventListener("click", function () {
      //change vid src
      this.vid = document.getElementById("videoSrc");
      if (this.vid.src != "https://192.168.1.172:3000/Component3.mp4") {
        this.vid.src = "https://192.168.1.172:3000/Component3.mp4";
        this.vid.play();
      }
      else {
        if (this.vid.paused) {
          this.vid.play()
        }
        else {
          this.vid.pause();

        }
      }
    });
  }

  //purpose of this is to prevent reinitializing of markerfound event, so that
  //vid paused can be played properly when marker goes out of frame
  let count = 0;

  //main function that handles marker detection events
  AFRAME.registerComponent('markerhandler', {
    init: function () {
      this.el.sceneEl.addEventListener('markerFound', () => {
        count += 1;
        createIntroButton();
        createComponentSceneButton();
        createComponent1Button();
        createComponent2Button();
        createComponent3Button();
      
        if (count == 1) {
          playIntroVid();
          playComponentVid();
          playComponent1Vid();
          playComponent2Vid();
          playComponent3Vid();

        }

      })
    }
  });

</script>
<style>
  .buttons-div {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 5em;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    margin: auto
  }

  .components-buttons-div {
    position: fixed;
    bottom:auto;
    left:0;
    width: 100%;
    height: 5em;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    margin: auto
  }


  .intro-button {
    padding: 0.25em;
    border-radius: 4px;
    border: none;
    background:darkred;
    color: white;
    width: 6em;
    height: 2em;
  }

  .componentScene-button {
    padding: 0.25em;
    border-radius: 4px;
    border: none;
    background: darkred;
    color: white;
    width: 6em;
    height: 2em;
    margin-left:5px
  }

  .component1-button {
    padding: 0.25em;
    border-radius: 4px;
    border: none;
    background:red;
    color: white;
    width: 6em;
    height: 2em;
    visibility: hidden;
  }

  .component2-button {
    padding: 0.25em;
    border-radius: 4px;
    border: none;
    background:red;
    color: white;
    width: 6em;
    height: 2em;
    margin-left:5px;
    visibility: hidden;

  }

  .component3-button {
    padding: 0.25em;
    border-radius: 4px;
    border: none;
    background:red;
    color: white;
    width: 6em;
    height: 2em;
    margin-left:5px;
    visibility: hidden;
  }
</style>

<body style="margin : 0px; overflow: hidden;">
  <container>
    <row>
      <div class="buttons-div" id="buttonDiv">
      </div>
    </row>
    <row>
      <div class="components-buttons-div" id="componentsButtonDiv">
      </div>

    </row>

  </container>




  <a-scene vr-mode-ui="enabled: false;" renderer="logarithmicDepthBuffer: true;" embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    <a-assets>
      <video src="https://192.168.1.172:3000/introVideo.mp4" preload="auto" id="videoSrc" response-type="arraybuffer"
        crossorigin webkit-playsinline playsinline>
      </video>
    </a-assets>

    <a-marker preset='hiro' markerhandler id="hiroMarker">

      <a-video width="1.333" height="1" rotation="-90 0 0" material='transparent:true;shader:flat;side:double;src:#videoSrc'>
      </a-video>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

</body>

</html>
